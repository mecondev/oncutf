# TableManager vs FileTableView Responsibility Map

Date: 2025-12-09

This document maps responsibilities between `core/table_manager.py` (application layer)
and `widgets/file_table_view.py` (UI layer). The goal is clarity: the manager
orchestrates app-specific flows, while the view owns UI details.

## Principle
- `TableManager`: application-level orchestration (what to show, which files are
  loaded, update preview maps, integrate with context and status managers).
- `FileTableView`: UI presentation and low-level behaviors (scrollbars, column
  widths, delegates, placeholder UI, drag & drop, hover visuals).

## Responsibilities (high level)

- `TableManager` (core responsibilities):
  - Prepare/clear table data (`prepare_file_table`, `clear_file_table`).
  - Coordinate with `FileStore`, `PreviewMap`, and `StatusManager`.
  - Provide selection-aware business logic (`get_selected_files`, `after_check_change`).
  - Trigger preview updates and UI label changes.

- `FileTableView` (UI responsibilities):
  - Render rows and cells, provide selection hooks and delegates.
  - Manage column visibility, sizes, and persistence (via `ColumnManagementMixin`).
  - Manage placeholder helper UI (`set_placeholder_visible`, `update_placeholder_visibility`).
  - Determine scrollbar visibility and header visibility (`_update_scrollbar_visibility`, `_update_header_visibility`).
  - Handle drag & drop internals and hover delegates.

## Safe refactor guidance

1. The manager SHOULD call only public view APIs. If a needed helper is internal
   (prefixed with `_`), introduce a small public wrapper on the view and
   replace usages in the manager.
2. Keep UI-only logic inside `FileTableView` so behavior is consistent across
   callers. Avoid duplicating scrollbar/header logic in `TableManager`.
3. Changes should be incremental and tested:
   - Add public wrapper if necessary.
   - Replace single callsites in `TableManager`.
   - Run tests and linters.

## Current low-risk improvement (applied)
- Added `FileTableView.ensure_scrollbar_visibility()` as a public wrapper for
  `_update_scrollbar_visibility()` so `TableManager` can call a stable public API.

## Notes and future improvements
- Consider adding explicit `set_header_enabled(bool)` on the view to centralize
  header UI logic (medium risk).
- Consider moving selection persistence helpers to `SelectionMixin` (requires
  broader testing).


*Generated by assistant on 2025-12-09*